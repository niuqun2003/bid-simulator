<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ‹›æ ‡æŠ¥ä»·æ¨¡æ‹Ÿåˆ†æç³»ç»Ÿ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .main-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .card h2 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 1.5em;
            border-bottom: 3px solid #667eea;
            padding-bottom: 10px;
        }

        .input-group {
            margin-bottom: 20px;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: 600;
        }

        .input-group input[type="number"],
        .input-group input[type="range"] {
            width: 100%;
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1em;
            transition: border-color 0.3s;
        }

        .input-group input[type="number"]:focus {
            outline: none;
            border-color: #667eea;
        }

        .input-group input[type="range"] {
            padding: 0;
            height: 8px;
        }

        .range-display {
            display: flex;
            justify-content: space-between;
            margin-top: 5px;
            font-size: 0.9em;
            color: #666;
        }

        .slider-value {
            color: #667eea;
            font-weight: bold;
            font-size: 1.1em;
        }

        .btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
        }

        .btn:active {
            transform: translateY(0);
        }

        .result-card {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            text-align: center;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 20px;
        }

        .result-card h3 {
            font-size: 1.8em;
            margin-bottom: 15px;
        }

        .score-display {
            font-size: 4em;
            font-weight: bold;
            margin: 20px 0;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }

        .probability {
            font-size: 2em;
            margin-top: 10px;
        }

        .detail-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .detail-item {
            background: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 10px;
            backdrop-filter: blur(10px);
        }

        .detail-item h4 {
            font-size: 1em;
            margin-bottom: 8px;
            opacity: 0.9;
        }

        .detail-item .value {
            font-size: 1.8em;
            font-weight: bold;
        }

        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .comparison-table th,
        .comparison-table td {
            padding: 12px;
            text-align: center;
            border-bottom: 1px solid #e0e0e0;
        }

        .comparison-table th {
            background: #f5f5f5;
            color: #333;
            font-weight: 600;
        }

        .comparison-table tr:hover {
            background: #f9f9f9;
        }

        .rank-1 { color: #ff6b6b; font-weight: bold; }
        .rank-2 { color: #ff8c42; }
        .rank-3 { color: #ffd93d; }

        .chart-container {
            margin-top: 30px;
            padding: 20px;
            background: #f9f9f9;
            border-radius: 10px;
        }

        .advice-box {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px;
            margin-top: 20px;
            border-radius: 5px;
        }

        .advice-box h4 {
            color: #856404;
            margin-bottom: 10px;
        }

        .advice-box ul {
            list-style-position: inside;
            color: #856404;
        }

        .advice-box li {
            margin-bottom: 8px;
        }

        .risk-indicator {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 15px;
        }

        .risk-bar {
            flex: 1;
            height: 20px;
            background: #e0e0e0;
            border-radius: 10px;
            overflow: hidden;
        }

        .risk-fill {
            height: 100%;
            transition: width 0.5s ease, background 0.5s ease;
        }

        .tech-score-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-top: 15px;
        }

        .tech-item {
            background: #f5f5f5;
            padding: 12px;
            border-radius: 8px;
        }

        .tech-item label {
            display: block;
            margin-bottom: 5px;
            font-size: 0.9em;
            color: #666;
        }

        .tech-item input {
            width: 100%;
            padding: 8px;
            border: 2px solid #e0e0e0;
            border-radius: 5px;
        }

        @media (max-width: 1024px) {
            .main-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.8em;
            }

            .score-display {
                font-size: 3em;
            }

            .detail-grid {
                grid-template-columns: 1fr;
            }
        }

        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }

        .loading.active {
            display: block;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .full-width {
            grid-column: 1 / -1;
        }

        .scenario-buttons {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .scenario-btn {
            flex: 1;
            min-width: 150px;
            padding: 10px;
            background: #f5f5f5;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .scenario-btn:hover {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .info-icon {
            display: inline-block;
            width: 18px;
            height: 18px;
            background: #667eea;
            color: white;
            border-radius: 50%;
            text-align: center;
            line-height: 18px;
            font-size: 12px;
            cursor: help;
            margin-left: 5px;
        }

        .tooltip {
            position: relative;
            display: inline-block;
        }

        .tooltip .tooltiptext {
            visibility: hidden;
            width: 200px;
            background-color: #555;
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 10px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -100px;
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 0.85em;
        }

        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ¯ æ‹›æ ‡æŠ¥ä»·æ¨¡æ‹Ÿåˆ†æç³»ç»Ÿ</h1>
            <p>æ±Ÿè‹åé€š/åæ±‡ç½‘ç»œå®‰å…¨æå‡é¡¹ç›® | å®æ—¶è®¡ç®—æœ€ä¼˜æŠ¥ä»·ç­–ç•¥</p>
        </div>

        <div class="main-grid">
            <!-- å·¦ä¾§ï¼šå‚æ•°è¾“å…¥ -->
            <div class="card">
                <h2>ğŸ“ åŸºç¡€å‚æ•°è®¾ç½®</h2>
                
                <div class="input-group">
                    <label>
                        æœ€é«˜æŠ•æ ‡é™ä»· (ä¸‡å…ƒ)
                        <span class="tooltip">
                            <span class="info-icon">?</span>
                            <span class="tooltiptext">æ‹›æ ‡æ–‡ä»¶è§„å®šçš„æœ€é«˜æŠ•æ ‡ä»·æ ¼ä¸Šé™</span>
                        </span>
                    </label>
                    <input type="number" id="maxLimit" value="29.788" step="0.001">
                </div>

                <div class="input-group">
                    <label>
                        æ‚¨çš„æŠ¥ä»· (ä¸‡å…ƒ)
                        <span class="tooltip">
                            <span class="info-icon">?</span>
                            <span class="tooltiptext">æ‹–åŠ¨æ»‘å—æˆ–ç›´æ¥è¾“å…¥æ‚¨è®¡åˆ’çš„æŠ•æ ‡ä»·æ ¼</span>
                        </span>
                    </label>
                    <input type="range" id="yourBidSlider" min="15" max="30" value="19.5" step="0.1">
                    <div class="range-display">
                        <span>15ä¸‡</span>
                        <span class="slider-value" id="sliderValue">19.5ä¸‡</span>
                        <span>30ä¸‡</span>
                    </div>
                    <input type="number" id="yourBid" value="19.5" step="0.1" style="margin-top: 10px;">
                </div>

                <div class="input-group">
                    <label>
                        å¸‚åœºå¹³å‡æŠ¥ä»· (ä¸‡å…ƒ)
                        <span class="tooltip">
                            <span class="info-icon">?</span>
                            <span class="tooltiptext">é¢„ä¼°å…¶ä»–æŠ•æ ‡äººçš„å¹³å‡æŠ¥ä»·æ°´å¹³</span>
                        </span>
                    </label>
                    <input type="number" id="avgBid" value="23" step="0.1">
                </div>

                <div class="scenario-buttons">
                    <button class="scenario-btn" onclick="setScenario('aggressive')">æ¿€è¿›å¸‚åœº<br>(20ä¸‡)</button>
                    <button class="scenario-btn" onclick="setScenario('moderate')">ä¸­ç­‰å¸‚åœº<br>(23ä¸‡)</button>
                    <button class="scenario-btn" onclick="setScenario('conservative')">ä¿å®ˆå¸‚åœº<br>(27ä¸‡)</button>
                </div>

                <div class="input-group" style="margin-top: 20px;">
                    <label>
                        è¯„æ ‡ä¸‹æµ®ç‡ (%)
                        <span class="tooltip">
                            <span class="info-icon">?</span>
                            <span class="tooltiptext">ç°åœºéšæœºæŠ½å–çš„ä¸‹æµ®ç‡: 0.5%, 1.0%, 1.5%, 2.0%, 2.5%</span>
                        </span>
                    </label>
                    <input type="range" id="downRate" min="0.5" max="2.5" value="1.5" step="0.5">
                    <div class="range-display">
                        <span>0.5%</span>
                        <span class="slider-value" id="downRateValue">1.5%</span>
                        <span>2.5%</span>
                    </div>
                </div>

                <div class="input-group">
                    <label>æŠ•æ ‡äººæ•°é‡</label>
                    <input type="number" id="bidderCount" value="5" min="3" max="15">
                </div>
            </div>

            <!-- å³ä¾§ï¼šæŠ€æœ¯æ ‡è¯„åˆ† -->
            <div class="card">
                <h2>ğŸ“ æŠ€æœ¯æ ‡è¯„åˆ†è®¾ç½®</h2>
                
                <div class="tech-score-grid">
                    <div class="tech-item">
                        <label>é¡¹ç›®ç»ç† (æ»¡åˆ†3åˆ†)</label>
                        <input type="number" id="techManager" value="3" min="0" max="3" step="0.5">
                    </div>
                    <div class="tech-item">
                        <label>æŠ€æœ¯è´Ÿè´£äºº (æ»¡åˆ†3åˆ†)</label>
                        <input type="number" id="techLeader" value="3" min="0" max="3" step="0.5">
                    </div>
                    <div class="tech-item">
                        <label>å®‰è£…å®æ–½äººå‘˜ (æ»¡åˆ†3åˆ†)</label>
                        <input type="number" id="techInstaller" value="3" min="0" max="3" step="0.5">
                    </div>
                    <div class="tech-item">
                        <label>ç½‘ç»œå®‰å…¨äººå‘˜ (æ»¡åˆ†8åˆ†)</label>
                        <input type="number" id="techSecurity" value="6" min="0" max="8" step="0.5">
                    </div>
                </div>

                <div class="input-group" style="margin-top: 20px;">
                    <label>äººå‘˜é…ç½®æ€»åˆ† (è‡ªåŠ¨è®¡ç®—)</label>
                    <input type="number" id="totalPersonnel" value="15" readonly style="background: #f0f0f0;">
                </div>

                <div class="tech-score-grid">
                    <div class="tech-item">
                        <label>èµ„è´¨è¯ä¹¦ (æ»¡åˆ†6åˆ†)</label>
                        <input type="number" id="qualification" value="6" min="0" max="6" step="1.5">
                    </div>
                    <div class="tech-item">
                        <label>å®‰å…¨é›†æˆæ¡ˆä¾‹ (æ»¡åˆ†1åˆ†)</label>
                        <input type="number" id="integrationCase" value="1" min="0" max="1" step="1">
                    </div>
                    <div class="tech-item">
                        <label>å®‰å…¨æœåŠ¡æ¡ˆä¾‹ (æ»¡åˆ†9åˆ†)</label>
                        <input type="number" id="serviceCase" value="6" min="0" max="9" step="1">
                    </div>
                    <div class="tech-item">
                        <label>å¢å€¼æœåŠ¡ (æ»¡åˆ†2åˆ†)</label>
                        <input type="number" id="valueService" value="2" min="0" max="2" step="1">
                    </div>
                </div>

                <div class="input-group" style="margin-top: 20px;">
                    <label>æŠ€æœ¯æ ‡æ€»åˆ† (è‡ªåŠ¨è®¡ç®—)</label>
                    <input type="number" id="totalTech" value="30" readonly style="background: #f0f0f0;">
                </div>

                <button class="btn" onclick="calculate()" style="margin-top: 20px;">ğŸš€ å¼€å§‹æ¨¡æ‹Ÿåˆ†æ</button>
            </div>
        </div>

        <!-- ç»“æœå±•ç¤º -->
        <div id="results" style="display: none;">
            <div class="result-card">
                <h3>ğŸ“Š æ‚¨çš„ç»¼åˆè¯„åˆ†</h3>
                <div class="score-display" id="totalScore">0</div>
                <div class="detail-grid">
                    <div class="detail-item">
                        <h4>ä»·æ ¼å¾—åˆ†</h4>
                        <div class="value" id="priceScore">0</div>
                    </div>
                    <div class="detail-item">
                        <h4>æŠ€æœ¯å¾—åˆ†</h4>
                        <div class="value" id="techScore">0</div>
                    </div>
                    <div class="detail-item">
                        <h4>ä»·æ ¼æ’å</h4>
                        <div class="value" id="priceRank">-</div>
                    </div>
                    <div class="detail-item">
                        <h4>é¢„ä¼°ä¸­æ ‡æ¦‚ç‡</h4>
                        <div class="value probability" id="winProb">0%</div>
                    </div>
                </div>
                
                <div class="risk-indicator">
                    <span style="font-weight: bold;">æŠ¥ä»·é£é™©ç­‰çº§:</span>
                    <div class="risk-bar">
                        <div class="risk-fill" id="riskFill" style="width: 50%; background: #4caf50;"></div>
                    </div>
                    <span id="riskLabel" style="font-weight: bold;">ä¸­ç­‰</span>
                </div>
            </div>

            <div class="card full-width">
                <h2>ğŸ“ˆ æŠ¥ä»·å¯¹æ¯”åˆ†æ</h2>
                <table class="comparison-table" id="comparisonTable">
                    <thead>
                        <tr>
                            <th>æŠ¥ä»·æ–¹æ¡ˆ</th>
                            <th>æŠ¥ä»·é‡‘é¢</th>
                            <th>ç›¸å¯¹åŸºå‡†ä»·</th>
                            <th>ä»·æ ¼å¾—åˆ†</th>
                            <th>ç»¼åˆå¾—åˆ†</th>
                            <th>å¾—åˆ†å·®è·</th>
                            <th>å»ºè®®</th>
                        </tr>
                    </thead>
                    <tbody id="comparisonBody">
                    </tbody>
                </table>

                <div class="advice-box" id="adviceBox">
                    <h4>ğŸ’¡ æ™ºèƒ½å»ºè®®</h4>
                    <ul id="adviceList">
                    </ul>
                </div>
            </div>

            <div class="card full-width">
                <h2>ğŸ¯ ä¸åŒä¸‹æµ®ç‡æƒ…æ™¯åˆ†æ</h2>
                <table class="comparison-table" id="downRateTable">
                    <thead>
                        <tr>
                            <th>ä¸‹æµ®ç‡</th>
                            <th>è¯„æ ‡åŸºå‡†ä»·</th>
                            <th>æ‚¨çš„ä»·æ ¼å¾—åˆ†</th>
                            <th>ç»¼åˆå¾—åˆ†</th>
                            <th>ä»·æ ¼æ’å</th>
                        </tr>
                    </thead>
                    <tbody id="downRateBody">
                    </tbody>
                </table>
            </div>
        </div>

        <div class="loading" id="loading">
            <div class="spinner"></div>
            <p style="margin-top: 10px; color: white;">æ­£åœ¨è®¡ç®—åˆ†æ...</p>
        </div>
    </div>

    <script>
        // åŒæ­¥æ»‘å—å’Œè¾“å…¥æ¡†
        const yourBidSlider = document.getElementById('yourBidSlider');
        const yourBidInput = document.getElementById('yourBid');
        const sliderValue = document.getElementById('sliderValue');
        const downRateSlider = document.getElementById('downRate');
        const downRateValue = document.getElementById('downRateValue');

        yourBidSlider.addEventListener('input', (e) => {
            const value = parseFloat(e.target.value);
            yourBidInput.value = value;
            sliderValue.textContent = value + 'ä¸‡';
        });

        yourBidInput.addEventListener('input', (e) => {
            const value = parseFloat(e.target.value);
            if (value >= 15 && value <= 30) {
                yourBidSlider.value = value;
                sliderValue.textContent = value + 'ä¸‡';
            }
        });

        downRateSlider.addEventListener('input', (e) => {
            downRateValue.textContent = e.target.value + '%';
        });

        // è‡ªåŠ¨è®¡ç®—æŠ€æœ¯æ ‡æ€»åˆ†
        function updateTechScores() {
            const personnel = parseFloat(document.getElementById('techManager').value || 0) +
                            parseFloat(document.getElementById('techLeader').value || 0) +
                            parseFloat(document.getElementById('techInstaller').value || 0) +
                            parseFloat(document.getElementById('techSecurity').value || 0);
            document.getElementById('totalPersonnel').value = personnel.toFixed(1);

            const tech = personnel +
                        parseFloat(document.getElementById('qualification').value || 0) +
                        parseFloat(document.getElementById('integrationCase').value || 0) +
                        parseFloat(document.getElementById('serviceCase').value || 0) +
                        parseFloat(document.getElementById('valueService').value || 0);
            document.getElementById('totalTech').value = tech.toFixed(1);
        }

        // ç›‘å¬æ‰€æœ‰æŠ€æœ¯åˆ†è¾“å…¥
        document.querySelectorAll('.tech-item input').forEach(input => {
            input.addEventListener('input', updateTechScores);
        });

        // è®¾ç½®å¸‚åœºæƒ…æ™¯
        function setScenario(type) {
            const scenarios = {
                'aggressive': 20,
                'moderate': 23,
                'conservative': 27
            };
            document.getElementById('avgBid').value = scenarios[type];
        }

        // è®¡ç®—ä»·æ ¼å¾—åˆ†
        function calcPriceScore(bid, basePrice) {
            const F = 65;
            const E1 = 4;
            const E2 = 2;
            
            if (bid > basePrice) {
                const deviation = (bid - basePrice) / basePrice;
                return Math.max(0, F - deviation * 100 * E1);
            } else {
                const deviation = (basePrice - bid) / basePrice;
                return Math.min(95, F + deviation * 100 * E2);
            }
        }

        // è®¡ç®—ä¸»å‡½æ•°
        function calculate() {
            // æ˜¾ç¤ºåŠ è½½åŠ¨ç”»
            document.getElementById('loading').classList.add('active');
            document.getElementById('results').style.display = 'none';

            setTimeout(() => {
                // è·å–è¾“å…¥å€¼
                const maxLimit = parseFloat(document.getElementById('maxLimit').value) * 10000;
                const yourBid = parseFloat(document.getElementById('yourBid').value) * 10000;
                const avgBid = parseFloat(document.getElementById('avgBid').value) * 10000;
                const downRate = parseFloat(document.getElementById('downRate').value) / 100;
                const bidderCount = parseInt(document.getElementById('bidderCount').value);
                const techScore = parseFloat(document.getElementById('totalTech').value);

                // è®¡ç®—è¯„æ ‡åŸºå‡†ä»·
                const basePrice = avgBid * (1 - downRate);

                // è®¡ç®—æ‚¨çš„ä»·æ ¼å¾—åˆ†
                const yourPriceScore = calcPriceScore(yourBid, basePrice);
                const yourTotalScore = yourPriceScore + techScore;

                // æ›´æ–°ç»“æœæ˜¾ç¤º
                document.getElementById('priceScore').textContent = yourPriceScore.toFixed(1) + 'åˆ†';
                document.getElementById('techScore').textContent = techScore.toFixed(1) + 'åˆ†';
                document.getElementById('totalScore').textContent = yourTotalScore.toFixed(1) + 'åˆ†';
                document.getElementById('priceRank').textContent = 'ğŸ¥‡ ç¬¬1å';

                // è®¡ç®—ä¸­æ ‡æ¦‚ç‡
                let winProb = 50;
                if (techScore >= 30) {
                    winProb = 85 + (yourPriceScore - 65) * 0.3;
                } else if (techScore >= 25) {
                    winProb = 70 + (yourPriceScore - 65) * 0.4;
                } else if (techScore >= 20) {
                    winProb = 50 + (yourPriceScore - 65) * 0.5;
                } else {
                    winProb = 30 + (yourPriceScore - 65) * 0.6;
                }
                winProb = Math.max(20, Math.min(98, winProb));
                document.getElementById('winProb').textContent = Math.round(winProb) + '%';

                // é£é™©è¯„ä¼°
                const discountRate = (1 - yourBid / maxLimit) * 100;
                let riskLevel, riskColor, riskWidth;
                if (discountRate > 35) {
                    riskLevel = 'é«˜é£é™©';
                    riskColor = '#f44336';
                    riskWidth = 85;
                } else if (discountRate > 25) {
                    riskLevel = 'ä¸­é«˜é£é™©';
                    riskColor = '#ff9800';
                    riskWidth = 65;
                } else if (discountRate > 15) {
                    riskLevel = 'ä¸­ç­‰é£é™©';
                    riskColor = '#ffc107';
                    riskWidth = 45;
                } else {
                    riskLevel = 'ä½é£é™©';
                    riskColor = '#4caf50';
                    riskWidth = 25;
                }
                document.getElementById('riskFill').style.width = riskWidth + '%';
                document.getElementById('riskFill').style.background = riskColor;
                document.getElementById('riskLabel').textContent = riskLevel;

                // ç”Ÿæˆå¯¹æ¯”åˆ†æè¡¨
                generateComparisonTable(yourBid, basePrice, techScore, yourTotalScore);

                // ç”Ÿæˆä¸åŒä¸‹æµ®ç‡æƒ…æ™¯
                generateDownRateScenarios(yourBid, avgBid, techScore);

                // ç”Ÿæˆæ™ºèƒ½å»ºè®®
                generateAdvice(discountRate, techScore, yourPriceScore, winProb);

                // éšè—åŠ è½½åŠ¨ç”»ï¼Œæ˜¾ç¤ºç»“æœ
                document.getElementById('loading').classList.remove('active');
                document.getElementById('results').style.display = 'block';
                
                // å¹³æ»‘æ»šåŠ¨åˆ°ç»“æœ
                document.getElementById('results').scrollIntoView({ behavior: 'smooth' });
            }, 500);
        }

        // ç”Ÿæˆå¯¹æ¯”åˆ†æè¡¨
        function generateComparisonTable(yourBid, basePrice, techScore, yourTotal) {
            const testBids = [
                yourBid,
                yourBid * 0.9,
                yourBid * 1.05,
                yourBid * 1.1,
                yourBid * 1.15,
                basePrice
            ].sort((a, b) => a - b);

            const tbody = document.getElementById('comparisonBody');
            tbody.innerHTML = '';

            testBids.forEach((bid, index) => {
                const priceScore = calcPriceScore(bid, basePrice);
                const totalScore = priceScore + techScore;
                const diff = totalScore - yourTotal;
                const isCurrent = Math.abs(bid - yourBid) < 100;

                let advice = '';
                if (isCurrent) {
                    advice = 'å½“å‰æŠ¥ä»·';
                } else if (diff > 0) {
                    advice = 'æ›´ä¼˜é€‰æ‹© âœ“';
                } else if (diff > -5) {
                    advice = 'å¯è€ƒè™‘';
                } else {
                    advice = 'ä¸æ¨è';
                }

                const row = `
                    <tr style="${isCurrent ? 'background: #e3f2fd; font-weight: bold;' : ''}">
                        <td>${isCurrent ? 'å½“å‰æ–¹æ¡ˆ' : 'æ–¹æ¡ˆ' + (index + 1)}</td>
                        <td>${(bid / 10000).toFixed(2)}ä¸‡</td>
                        <td>${bid > basePrice ? '+' : ''}${((bid - basePrice) / 10000).toFixed(2)}ä¸‡</td>
                        <td class="${priceScore >= 85 ? 'rank-1' : priceScore >= 75 ? 'rank-2' : 'rank-3'}">${priceScore.toFixed(1)}åˆ†</td>
                        <td>${totalScore.toFixed(1)}åˆ†</td>
                        <td>${diff >= 0 ? '+' : ''}${diff.toFixed(1)}åˆ†</td>
                        <td>${advice}</td>
                    </tr>
                `;
                tbody.innerHTML += row;
            });
        }

        // ç”Ÿæˆä¸åŒä¸‹æµ®ç‡æƒ…æ™¯
        function generateDownRateScenarios(yourBid, avgBid, techScore) {
            const downRates = [0.5, 1.0, 1.5, 2.0, 2.5];
            const tbody = document.getElementById('downRateBody');
            tbody.innerHTML = '';

            downRates.forEach(rate => {
                const basePrice = avgBid * (1 - rate / 100);
                const priceScore = calcPriceScore(yourBid, basePrice);
                const totalScore = priceScore + techScore;

                const row = `
                    <tr>
                        <td>${rate.toFixed(1)}%</td>
                        <td>${(basePrice / 10000).toFixed(2)}ä¸‡</td>
                        <td class="${priceScore >= 85 ? 'rank-1' : priceScore >= 75 ? 'rank-2' : 'rank-3'}">${priceScore.toFixed(1)}åˆ†</td>
                        <td>${totalScore.toFixed(1)}åˆ†</td>
                        <td>ğŸ¥‡ ç¬¬1å</td>
                    </tr>
                `;
                tbody.innerHTML += row;
            });
        }

        // ç”Ÿæˆæ™ºèƒ½å»ºè®®
        function generateAdvice(discountRate, techScore, priceScore, winProb) {
            const adviceList = document.getElementById('adviceList');
            adviceList.innerHTML = '';

            const advices = [];

            // æ ¹æ®ä¸‹æµ®ç‡ç»™å»ºè®®
            if (discountRate > 35) {
                advices.push('âš ï¸ æŠ¥ä»·ä¸‹æµ®è¶…è¿‡35%,å¯èƒ½å¼•èµ·è¯„å§”è´¨ç–‘ã€‚å»ºè®®é€‚å½“æé«˜è‡³25-30%åŒºé—´ã€‚');
            } else if (discountRate > 25) {
                advices.push('âœ“ æŠ¥ä»·ä¸‹æµ®é€‚ä¸­,ä»·æ ¼ç«äº‰åŠ›å¼º,ä½†éœ€æ³¨æ„æˆæœ¬æ§åˆ¶ã€‚');
            } else if (discountRate < 15) {
                advices.push('ğŸ’¡ æŠ¥ä»·åä¿å®ˆ,å»ºè®®é€‚å½“é™ä½ä»¥å¢å¼ºç«äº‰åŠ›ã€‚');
            }

            // æ ¹æ®æŠ€æœ¯åˆ†ç»™å»ºè®®
            if (techScore < 25) {
                advices.push('ğŸ“‹ æŠ€æœ¯æ ‡å¾—åˆ†åä½(< 25åˆ†),å¼ºçƒˆå»ºè®®è¡¥å……äººå‘˜é…ç½®å’Œä¸šç»©è¯æ˜ææ–™ã€‚');
            } else if (techScore < 30) {
                advices.push('ğŸ“‹ æŠ€æœ¯æ ‡å¾—åˆ†è‰¯å¥½,å»ºè®®ç»§ç»­å®Œå–„å±¥çº¦èƒ½åŠ›è¯æ˜ææ–™ã€‚');
            } else {
                advices.push('âœ“ æŠ€æœ¯æ ‡å¾—åˆ†ä¼˜ç§€,ä¿æŒå½“å‰é…ç½®å³å¯ã€‚');
            }

            // æ ¹æ®ä»·æ ¼åˆ†ç»™å»ºè®®
            if (priceScore >= 90) {
                advices.push('ğŸ¯ ä»·æ ¼å¾—åˆ†æé«˜(â‰¥90åˆ†),åœ¨ä»·æ ¼ç»´åº¦å…·æœ‰æ˜¾è‘—ä¼˜åŠ¿ã€‚');
            } else if (priceScore >= 80) {
                advices.push('ğŸ¯ ä»·æ ¼å¾—åˆ†è‰¯å¥½(80-90åˆ†),ä¿æŒåˆç†ç«äº‰åŠ›ã€‚');
            } else {
                advices.push('âš ï¸ ä»·æ ¼å¾—åˆ†åä½,å»ºè®®é™ä½æŠ¥ä»·ä»¥æå‡ä»·æ ¼ç«äº‰åŠ›ã€‚');
            }

            // æ ¹æ®ä¸­æ ‡æ¦‚ç‡ç»™å»ºè®®
            if (winProb >= 80) {
                advices.push('ğŸ† ç»¼åˆä¸­æ ‡æ¦‚ç‡å¾ˆé«˜(â‰¥80%),ä¿æŒå½“å‰ç­–ç•¥ã€‚');
            } else if (winProb >= 60) {
                advices.push('ğŸ† ç»¼åˆä¸­æ ‡æ¦‚ç‡è¾ƒé«˜(60-80%),å¯è€ƒè™‘ä¼˜åŒ–æŠ€æœ¯æ ‡æˆ–ä»·æ ¼ã€‚');
            } else {
                advices.push('âš ï¸ ç»¼åˆä¸­æ ‡æ¦‚ç‡åä½(< 60%),å»ºè®®åŒæ—¶ä¼˜åŒ–ä»·æ ¼å’ŒæŠ€æœ¯æ ‡ã€‚');
            }

            // å…³é”®è¡ŒåŠ¨å»ºè®®
            advices.push('âœ… é‡ç‚¹å‡†å¤‡: 3ä¸ª50ä¸‡+çš„ç½‘ç»œå®‰å…¨æœåŠ¡æ¡ˆä¾‹(å¯è·9åˆ†),4ç±»èµ„è´¨è¯ä¹¦(å¯è·6åˆ†)ã€‚');
            advices.push('âœ… ç¡®ä¿é…å¤‡: ä¿¡æ¯ç³»ç»Ÿé¡¹ç›®ç®¡ç†å¸ˆã€åº”æ€¥å“åº”å·¥ç¨‹å¸ˆã€åŸå‚è®¤è¯å·¥ç¨‹å¸ˆã€‚');

            advices.forEach(advice => {
                const li = document.createElement('li');
                li.textContent = advice;
                adviceList.appendChild(li);
            });
        }

        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        window.addEventListener('load', () => {
            updateTechScores();
        });
    </script>
</body>
</html>